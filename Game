import pandas as pd

# Step 1: Load Excel files
df1 = pd.read_excel("JUN25.xlsx")   # Main table
df2 = pd.read_excel("i984.xlsx")    # Amount / mapping table

# Step 2: Group df2 to ensure one row per key
# (Assume 'A' is the column to join on, and 'Amount' is your value)
df2_grouped = df2.groupby('A', as_index=False)['Amount'].sum()

# Step 3: Merge without increasing row count
df_merged = df1.merge(df2_grouped, on='A', how='left')  # 'A' is unique in df1

# Step 4: Apply grouping logic if criterion = 'i984_2'
if 'criterion' in df1.columns:
    for criterion in df1['criterion'].unique():
        if criterion == 'i984_2':
            # Example: group by multiple columns (SAGA, etc.)
            grouped_result = (
                df_merged
                .groupby(['SAGA-B35M', '7390P', '98763'], dropna=False)
                ['Amount']
                .sum()
                .reset_index()
            )

print("âœ… Merge done without increasing count.")