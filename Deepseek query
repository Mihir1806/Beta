def convert_if_else_to_case(formula):
    lines = formula.strip().split('\n')
    case_lines = []
    in_case = False

    for line in lines:
        line = line.strip()
        upper_line = line.upper()

        if upper_line.startswith('IF '):
            condition = line[3:].strip().rstrip('THEN').strip()
            case_lines.append(f'CASE WHEN {condition} THEN')
            in_case = True

        elif upper_line.startswith('ELSEIF '):
            condition = line[7:].strip().rstrip('THEN').strip()
            case_lines.append(f'WHEN {condition} THEN')

        elif upper_line.startswith('ELSE'):
            case_lines.append('ELSE')

        elif upper_line.startswith('ENDIF'):
            case_lines.append('END')
            in_case = False

        elif in_case:
            # Add result for THEN or ELSE line (previous WHEN or ELSE should exist)
            if len(case_lines) > 0 and (
                case_lines[-1].startswith('CASE WHEN') or 
                case_lines[-1].startswith('WHEN') or 
                case_lines[-1] == 'ELSE'):
                case_lines[-1] += f" '{line}'"
            else:
                # malformed structure, skip or raise warning
                pass

    return '\n'.join(case_lines)