let
    // Source the LOG_STATUS table
    Source = Excel.CurrentWorkbook(){[Name="LOG_STATUS"]}[Content],
    #"Changed Type" = Table.TransformColumnTypes(Source,{{"Job Name", type text}, {"Error", type text}}),

    // Source the ToolList table
    ToolListSource = Excel.CurrentWorkbook(){[Name="ToolList"]}[Content],
    #"Changed Type1" = Table.TransformColumnTypes(ToolListSource,{{"Job Name", type text}, {"Tool ID", Int64.Type}, {"Tool Name", type text}}),

    // Merge ToolList with LOG_STATUS to bring in Tool ID
    #"Merged Queries" = Table.NestedJoin(#"Changed Type", {"Job Name"}, #"Changed Type1", {"Job Name"}, "ToolListInfo", JoinKind.LeftOuter),
    #"Expanded ToolListInfo" = Table.ExpandTableColumn(#"Merged Queries", "ToolListInfo", {"Tool ID"}, {"Tool ID"}),

    // Add the custom error column
    #"Added Custom" = Table.AddColumn(#"Expanded ToolListInfo", "Formatted Error", each
        if [Error] <> null then
            let
                currentJobID = [Job Name],
                currentToolID = [Tool ID],
                toolNameRecord = Table.SelectRows(#"Changed Type1", (row) => row[#"Job Name"] = currentJobID and row[#"Tool ID"] = currentToolID),
                toolName = if Table.IsEmpty(toolNameRecord) then null else toolNameRecord{0}[#"Tool Name"],
                errorText = if toolName <> null then
                    Text.Format("Error ToolId <0>: <1> (Tool Name: <2>)", {[Tool ID], [Error], toolName})
                else
                    Text.Format("Error ToolId <0>: <1>", {[Tool ID], [Error]})
            in
                errorText
        else
            null
    ),

    // Group by Job Name and aggregate the errors
    #"Grouped Rows" = Table.Group(#"Added Custom", {"Job Name"}, {
        {"Combined Errors", each Text.Combine(List.RemoveNulls([Formatted Error]), "#(lf)"), type text}
    }),

    // Merge the combined errors back into the original LOG_STATUS table
    #"Merged with Grouped Errors" = Table.NestedJoin(#"Changed Type", {"Job Name"}, #"Grouped Rows", {"Job Name"}, "ErrorDetails", JoinKind.LeftOuter),
    #"Expanded ErrorDetails" = Table.ExpandTableColumn(#"Merged with Grouped Errors", "ErrorDetails", {"Combined Errors"}, {"Combined Errors"})

in
    #"Expanded ErrorDetails"
